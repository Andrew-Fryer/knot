<chapter>
  <title>Knot DNS Installation</title>
  <section>
    <title>Required build environment</title>
    <para>
      [TODO] Describe lowest needed GCC/Clang, etc.
    </para>
  </section>
  <section>
    <title>Required libraries</title>
    <para>
      Knot DNS requires few libraries to be compiled:
      <itemizedlist>
	<listitem>OpenSSL</listitem>
	<listitem>zlib</listitem>
	<listitem>Userspace RCU</listitem>
      </itemizedlist>
    </para>
    <para>
      You can probably find OpenSSL and zlib libraries already included
      in your system or distribution.  If not, zlib resides at
      <link xl:href="http://zlib.net/">http://zlib.net</link>, and OpenSSL can be found at
      <link xl:href="http://www.openssl.org/">OpenSSL</link>.
    </para>

    <section>
      <title>Userspace RCU</title>
      <para>
	liburcu is a LGPLv2.1 userspace RCU (read-copy-update)
	library. This data synchronization library provides read-side
	access which scales linearly with the number of cores. It does
	so by allowing multiples copies of a given data structure to
	live at the same time, and by monitoring the data structure
	accesses to detect grace periods after which memory reclamation
	is possible.  (<link xl:href="http://lttng.org/urcu">Userspace RCU</link>)
      </para>
      <para>
	Binary packages for Debian can be found under liburcu1 for the
	library and liburcu-dev for development files.
      </para>
      <para>
	Minimum supported version of Userspace RCU library is 0.4.0,
	but we recommend using latest available version.  It is
	especially on non-Linux systems as we got some compatibility
	patches accepted in later releases of Userspace RCU.
      </para>
    </section>
  </section>

  <section>
    <title>Installation from the sources</title>
    <para>
      After unpacking the sources, the compilation and installation is
      a quite straightforward process using autotools.
    </para>
    <section>
      <title>Configuring and generating Makefiles</title>
      <para>
	For all available options run:
	<programlisting>
	  ./configure --help
	</programlisting>
      </para>
      <para>
	In most simple case you can just run configure without any options.
	<programlisting>
	  ./configure
	</programlisting>
      </para>
    </section>
    <section>
      <title>Compilation</title>
      <para>
	After running <filename>./configure</filename> you can compile
	Knot DNS by running make command, which will produce binaries
	and other related files.
	<programlisting>
	  make
	</programlisting>
      </para>
      <para>
	Knot DNS build process is safe to paralelize
	using <filename>make -j N</filename>, where N is number of
	concurrent processes.  Using this option can increase speed of
	the compilation.
	<programlisting>
	  make -j N
	</programlisting>
      </para>
    </section>
    <section>
      <title>Installation</title>
      <para>
	When you have finished building the Knot DNS, it's time to
	install the binaries and configuration files into the
	operation system hierarchy.  You can do so by
	executing <filename>make install</filename> command.  When installing as a
	non-root user you might have to gain elevated privileges by
	switching to root user, e.g. <filename>sudo make install</filename>
	or <filename>su -c 'make install'</filename>.
	<programlisting>
	  make install
	</programlisting>
      </para>
    </section>
  </section>
  <section>
    <title>Installation from packages</title>
    <para>
      In addition to providing the packages in .DEB and .RPM format,
      the Knot DNS might already be available in your favourite
      distribution, or in a ports tree.
    </para>
    <section>
      <title>Installing Knot DNS packages on Debian</title>
      <para>
	Knot DNS is already available from Debian wheezy upwards.  In
	addition to the official packages we also provide custom
	repository, which can be used by adding:
	<programlisting>
	  deb     http://deb.knot-dns.cz/debian/ &lt;codename&gt; main
	  deb-src http://deb.knot-dns.cz/debian/ &lt;codename&gt; main
	</programlisting>
	to your /etc/apt/sources.list or into separate file in
	/etc/apt/sources.list.d/.
      </para>
      <para>
	As an example, for Debian squeeze (current stable) the Knot
	DNS packages can be added by executing following command as
	the root user.
	<programlisting>
	  cat &gt;/etc/apt/sources.list.d/knot.list &lt;&lt;EOF
	  deb     http://deb.knot-dns.cz/debian/ &lt;codename&gt; main
	  deb-src http://deb.knot-dns.cz/debian/ &lt;codename&gt; main
	  EOF
	  apt-get update
	  apt-get install knot
	</programlisting>
      </para>
    </section>
    <section>
      <title>Installing Knot DNS packages on Ubuntu</title>
      <para>
	Prepackaged version of the Knot DNS can be found in Ubuntu
	from version 12.10 (Quantal Quetzal).  In addition to the
	package included in the main archive, we provide Personal
	Package Archive (PPA) as an option to upgrade to last stable
	version of the Knot DNS or to install it on older versions of
	Ubuntu Linux.
      </para>
      <para>
	We typically provide packages for all supported versions of
	Ubuntu Linux including 5 year support
	for <link xl:href="https://wiki.ubuntu.com/LTS">LTS</link>
	versions of Ubuntu Linux.  At the time of writing this manual
	this includes Ubuntu 10.04 LTS, 11.04, 11.10 and 12.04 LTS.
      </para>
      <section>
	<title>Adding official PPA repository for Knot DNS</title>
	<para>
	  To start installing and using software from a Personal
	  Package Archive, you first need to tell Ubuntu where to find
	  the PPA.
	  <programlisting>
	    sudo add-apt-repository ppa:cz.nic-labs/knot-dns
	    sudo apt-get update
	    sudo apt-get install knot
	  </programlisting>
	  Running this sequence of command will ensure that you will
	  install the Knot DNS on your system and keep it up-to-date
	  in the future, when new version are released.
	</para>
      </section>

    </section>
    <section>
      <title>Installing Knot DNS RPMs on Fedora</title>
      <para>
	[TODO]
      </para>
    </section>
    <section>
      <title>Installing Knot DNS from ports on FreeBSD</title>
      <para>
	[TODO]
      </para>
    </section>
  </section>
</chapter>
